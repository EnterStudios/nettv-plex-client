(function() {
    describe('Video', function() {

        describe('#constructor(XML)', function(){
            it('should parse valid XML Plex data', function() {

                var parser = new DOMParser();
                var doc = parser.parseFromString('<?xml version="1.0" encoding="UTF-8"?><Video ratingKey="1" key="/library/metadata/1" guid="com.plexapp.agents.imdb://tt0116922?lang=en" studio="October Films" type="movie" title="Lost Highway" contentRating="R" summary="summary" rating="8.6000003814697301" year="1997" thumb="/library/metadata/1/thumb?t=1355992507" art="/library/metadata/1/art?t=1355992507" duration="8040000" originallyAvailableAt="1997-01-15" addedAt="1355992484" updatedAt="1355992507"><Media id="1" container=""><Part key="/library/parts/1/file.mkv" file="/Users/jhn/Movies/Lost Highway.mkv" size="5" /></Media><Genre id="20" tag="Thriller" /><Genre id="21" tag="Indie" /><Genre id="22" tag="Mystery" /><Genre id="23" tag="Crime Thriller" /><Genre id="24" tag="Neo-noir" /><Genre id="25" tag="Horror" /><Genre id="26" tag="Surrealism" /><Genre id="27" tag="Drama" /><Genre id="28" tag="Psychological thriller" /><Writer id="2" tag="David Lynch" /><Writer id="3" tag="Barry Gifford" /><Director id="1" tag="David Lynch" /><Country id="29" tag="France" /><Role id="4" tag="Michael Massee" role="Andy" /><Role id="5" tag="Robert Loggia" role="Dick Laurent" /><Role id="6" tag="Natasha Gregson Wagner" role="Sheila" /><Role id="7" tag="Marilyn Manson" role="" /><Role id="8" tag="Richard Pryor" role="Arnie" /><Role id="9" tag="Jack Kehler" role="Guard Johnny Mack" /><Role id="10" tag="Giovanni Ribisi" role="Steve &apos;V&apos;" /><Role id="11" tag="Scott Coffey" role="Teddy" /><Role id="12" tag="Gary Busey" role="Bill Dayton" /><Role id="13" tag="Jack Nance" role="Phil" /><Role id="14" tag="Henry Rollins" role="Guard Henry" /><Role id="15" tag="Lucy Butler" role="Candace Dayton" /><Role id="16" tag="Patricia Arquette" role="Alice Wakefield" /><Role id="17" tag="Bill Pullman" role="Fred Madison" /><Role id="16" tag="Patricia Arquette" role="Renee Madison" /><Role id="18" tag="Balthazar Getty" role="Pete Dayton" /><Role id="19" tag="Robert Blake" role="Mystery Man" /></Video>', 'application/xml');
                var video = new Video(doc.firstChild);

                expect(video.title).to.equal('Lost Highway');
            });
            it('should extract codec information', function() {

                var parser = new DOMParser();
                var doc = parser.parseFromString('<?xml version="1.0" encoding="UTF-8"?><Video ratingKey="4" key="/library/metadata/4" guid="com.plexapp.agents.imdb://tt0137523?lang=en" studio="Regency Enterprises" type="movie" title="Fight Club" contentRating="R" summary="Fight Club is a 1999 American film based on the 1996 novel of the same name by Chuck Palahniuk. The film was directed by David Fincher and stars Edward Norton, Brad Pitt, and Helena Bonham Carter. Norton plays the unnamed protagonist, an &quot;everyman&quot; who is discontented with his white-collar job. He forms a &quot;fight club&quot; with soap maker Tyler Durden, played by Pitt, and becomes embroiled in a relationship with him and a dissolute woman, Marla Singer, played by Bonham Carter.&#xA;&#xA;Palahniuk&apos;s novel was optioned by 20th Century Fox producer Laura Ziskin, who hired Jim Uhls to write the film adaptation. Fincher was one of four directors the producers considered and hired him because of his enthusiasm for the film. Fincher developed the script with Uhls and sought screenwriting advice from the cast and others in the film industry. The director and the cast compared the film to Rebel Without a Cause (1955) and The Graduate (1967). Fincher intended Fight Clubs violence to serve as a metaphor for the conflict between a generation of young people and the value system of advertising. The director copied the homoerotic overtones from Palahniuk&apos;s novel to make audiences uncomfortable and keep them from anticipating the twist ending.&#xA;&#xA;Studio executives did not like the film and they restructured Fincher&apos;s intended marketing campaign to try to reduce anticipated losses. Fight Club failed to meet the studio&apos;s expectations at the box office and received polarized reactions from critics. It was cited as one of the most controversial and talked-about films of 1999. However, the film later found commercial success with its DVD release, which established Fight Club as a cult film. Critical reception of Fight Club has since become more positive.&#xA;&#xA;In 2008, Fight Club was named the 10th greatest movie of all time by Empire magazine in its issue of The 500 Greatest Movies of All Time." rating="9" year="1999" tagline="Mischief. Mayhem. Soap." thumb="/library/metadata/4/thumb/1357564441" art="/library/metadata/4/art/1357564441" duration="8340000" originallyAvailableAt="1999-09-10" addedAt="1357564407" updatedAt="1357564441"><Media id="4" duration="8008" bitrate="3129" width="1024" height="576" aspectRatio="1.78" audioChannels="2" audioCodec="aac" videoCodec="h264" videoResolution="576" container="mp4" videoFrameRate="PAL" optimizedForStreaming="1"><Part id="4" key="/library/parts/4/file.mp4" duration="8008" file="/Users/jhn/Movies/Fight Club.mp4" size="3144689" container="mp4" has64bitOffsets="0" optimizedForStreaming="1"><Stream id="2" streamType="1" codec="h264" index="0" bitrate="2867" language="English" languageCode="eng" cabac="0" duration="8008" frameRate="25.000" height="576" level="31" profile="main" refFrames="3" width="1024" /><Stream id="3" streamType="2" selected="1" codec="aac" index="1" channels="2" bitrate="129" language="English" languageCode="eng" bitrateMode="vbr" duration="8008" profile="lc" samplingRate="44100" /></Part></Media><Genre id="20" tag="Thriller" /><Genre id="89" tag="Cult" /><Genre id="90" tag="Airplanes and airports" /><Genre id="91" tag="Action" /><Genre id="69" tag="Existentialism" /><Genre id="92" tag="Action/Adventure" /><Genre id="93" tag="Satire" /><Genre id="27" tag="Drama" /><Genre id="28" tag="Psychological thriller" /><Genre id="94" tag="Black comedy" /><Writer id="73" tag="Jim Uhls" /><Director id="72" tag="David Fincher" /><Country id="71" tag="USA" /><Role id="74" tag="David Andrews" role="Thomas" /><Role id="75" tag="Zach Grenier" role="Richard Chesler" /><Role id="76" tag="Richmond Arquette" role="Intern" /><Role id="77" tag="Eugenie Bondurant" role="Weeping Woman" /><Role id="78" tag="Christina Cabot" role="Group Leader" /><Role id="79" tag="George Maguire" role="Group Leader" /><Role id="80" tag="Rachel Singer" role="Chloe" /><Role id="81" tag="Bob Stephenson" role="Airport Security Officer" /><Role id="82" tag="Ezra Buzzington" role="Inspector Dent" /><Role id="83" tag="Tim De Zarn" role="Inspector Bird" /><Role id="84" tag="Edward Norton" role="" /><Role id="85" tag="Brad Pitt" role="Tyler Durden" /><Role id="86" tag="Helena Bonham Carter" role="Marla Singer" /><Role id="87" tag="Meat Loaf" role="Robert &apos;Bob&apos; Paulson" /><Role id="88" tag="Jared Leto" role="Angel Face" /></Video>', 'application/xml');
                var video = new Video(doc.firstChild);

                expect(video.stream.video.codec).to.equal('h264');
                expect(video.stream.audio.codec).to.equal('aac');
            });
        });
    });
})();
